# Engine API -- EIP-8025

Engine API methods for stateless validation using execution proofs.

This specification is based on and extends [Engine API - Osaka](./osaka.md) specification.

## Table of contents

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [Structures](#structures)
  - [PublicInputV1](#publicinputv1)
  - [ExecutionProofV1](#executionproofv1)
  - [ProofAttributesV1](#proofAttributesv1)
  - [ExecutionPayloadHeaderV1](#executionpayloadheaderv1)
  - [NewPayloadRequestHeaderV1](#newpayloadrequestheaderv1)
  - [ProofStatusV1](#proofstatusv1)
- [Methods](#methods)
  - [engine_verifyExecutionProofV1](#engine_verifyexecutionproofv1)
  - [engine_verifyNewPayloadRequestHeaderV1](#engine_verifynewpayloadrequestheaderv1)
  - [engine_requestProofsV1](#engine_requestproofsv1)
- [Errors](#errors)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Configuration

*Note*: The configuration values are not definitive.

| Name                            | Value | Description |
|--------------------------------|-------|-------------|
| `MIN_REQUIRED_EXECUTION_PROOFS` | `1`   | Minimum number of valid execution proofs required to satisfy proof requirements |

## Structures

### PublicInputV1

The fields are encoded as follows:

- `newPayloadRequestRoot`: `DATA`, 32 Bytes - The hash tree root of the `NewPayloadRequest`.

### ExecutionProofV1

The fields are encoded as follows:

- `proofData`: `DATA` - Variable length proof data, maximum 300 KiB.
- `proofType`: `QUANTITY`, 64 Bits - Type identifier for the proof system.
- `publicInput`: `Object` - A [`PublicInputV1`](#publicinputv1) object.

### ProofAttributesV1

The fields are encoded as follows:

- `proofTypes`: `Array of QUANTITY` - Array of proof type identifiers to request.

### ExecutionPayloadHeaderV1

This structure maps on the [`ExecutionPayloadHeader`] structure of the beacon chain spec.
The fields are encoded as follows:

- `parentHash`: `DATA`, 32 Bytes
- `feeRecipient`: `DATA`, 20 Bytes
- `stateRoot`: `DATA`, 32 Bytes
- `receiptsRoot`: `DATA`, 32 Bytes
- `logsBloom`: `DATA`, 256 Bytes
- `prevRandao`: `DATA`, 32 Bytes
- `blockNumber`: `QUANTITY`, 64 Bits
- `gasLimit`: `QUANTITY`, 64 Bits
- `gasUsed`: `QUANTITY`, 64 Bits
- `timestamp`: `QUANTITY`, 64 Bits
- `extraData`: `DATA`, 0 to 32 Bytes
- `baseFeePerGas`: `QUANTITY`, 256 Bits
- `blockHash`: `DATA`, 32 Bytes
- `transactionsRoot`: `DATA`, 32 Bytes - The hash tree root of the transactions included in the payload.
- `withdrawalsRoot`: `DATA`, 32 Bytes - The hash tree root of the withdrawals included in the payload.
- `blobGasUsed`: `QUANTITY`, 64 Bits
- `excessBlobGas`: `QUANTITY`, 64 Bits

### NewPayloadRequestHeaderV1

The fields are encoded as follows:

- `executionPayloadHeader`: `Object` - An [`ExecutionPayloadHeaderV1`](#executionpayloadheaderv1) object.
- `versionedHashes`: `Array of DATA`, 32 Bytes each - Array of blob versioned hashes.
- `parentBeaconBlockRoot`: `DATA`, 32 Bytes - Root of the parent beacon block.
- `executionRequests`: `Array of DATA` - Execution layer triggered requests.

### ProofStatusV1

The fields are encoded as follows:

- `status`: `String` - The verification status. One of:
  - `"VALID"` - The proof/header verification succeeded.
  - `"INVALID"` - The proof/header verification failed.
  - `"SYNCING"` - Less than `MIN_REQUIRED_EXECUTION_PROOFS` valid proofs have been verified for the given header.
  - `"NOT_SUPPORTED"` - The proof type is not supported by this client.
- `error`: `String` - Optional error message if status is not `"VALID"`.

## Methods

*Note*: The timeouts are not definitive.

### engine_verifyExecutionProofV1

#### Request

* method: `engine_verifyExecutionProofV1`
* params:
  1. `executionProof`: [`ExecutionProofV1`](#executionproofv1) - The execution proof to verify.
* timeout: 1s

#### Response

* result: [`ProofStatusV1`](#proofstatusv1) - The verification result.
* error: code and message set in case an exception happens while verifying the proof.

#### Specification

1. Client software **MUST** validate the `executionProof` parameter:
   - `proofData` **MUST** be non-empty and not exceed 300 KiB.
   - `proofType` **MUST** be a supported proof type.
   - `publicInput.newPayloadRequestRoot` **MUST** be a valid 32-byte hash.

2. Client software **MUST** verify the execution proof using the appropriate proof verification algorithm based on `proofType`.

3. Client software **MUST** respond with `{status: "VALID"}` if the proof is valid, `{status: "INVALID", error: "..."}` if the proof is invalid, or `{status: "NOT_SUPPORTED", error: "..."}` if the proof type is not supported.

### engine_verifyNewPayloadRequestHeaderV1

#### Request

* method: `engine_verifyNewPayloadRequestHeaderV1`
* params:
  1. `newPayloadRequestHeader`: [`NewPayloadRequestHeaderV1`](#newpayloadrequestheaderv1) - The header to verify.
* timeout: 1s

#### Response

* result: [`ProofStatusV1`](#proofstatusv1) - The verification result.
* error: code and message set in case an exception happens while verifying.

#### Specification

1. Client software **MUST** validate the `newPayloadRequestHeader` parameter structure.

2. Client software **MUST** respond with `{status: "VALID"}` if at least `MIN_REQUIRED_EXECUTION_PROOFS` proofs have been verified for this `NewPayloadRequestHeader`, or `{status: "SYNCING "}` if not.

### engine_requestProofsV1

#### Request

* method: `engine_requestProofsV1`
* params:
  1. `executionPayload`: [`ExecutionPayloadV3`](./cancun.md#executionpayloadv3) - The execution payload to generate proofs for.
  2. `versionedHashes`: `Array of DATA`, 32 Bytes each - Array of blob versioned hashes.
  3. `parentBeaconBlockRoot`: `DATA`, 32 Bytes - Root of the parent beacon block.
  4. `executionRequests`: `Array of DATA` - List of execution layer triggered requests.
  5. `proofAttributes`: [`ProofAttributesV1`](#proofAttributesv1) - Attributes specifying which proofs to generate.
* timeout: 1s

#### Response

* result: `DATA`, 8 Bytes - A `ProofGenId` to track the proof generation request.
* error: code and message set in case an exception happens while initiating proof generation.

#### Specification

1. Client software **MUST** validate all parameters.

2. Client software **MUST** initiate asynchronous proof generation for the given payload and return a `ProofGenId` immediately.

3. Generated proofs are delivered asynchronously via the beacon API endpoint `POST /eth/v1/prover/execution_proofs`. The client **MUST NOT** block waiting for proof generation to complete.

4. If proof generation is unavailable (e.g., no prover configured), client software **MUST** return error code `-39004`.

## Errors

| Code | Message | Meaning |
|------|---------|---------|
| -39001 | Invalid proof format | The execution proof structure is malformed |
| -39002 | Invalid header format | The new payload request header structure is malformed |
| -39003 | Invalid payload | The execution payload is invalid |
| -39004 | Proof generation unavailable | The client cannot generate proofs |
